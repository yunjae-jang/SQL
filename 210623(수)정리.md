# 서브쿼리(Subquery) - 개요
- 일반적인 쿼리(메인,주 쿼리) 안에 있는 또 다른 쿼리 => 보조,하위 쿼리
- 메인쿼리 + 서브쿼리 => 한문장
- 서브쿼리는 하나의 SELECT 문장으로, 괄호로 둘러싸인 형태
- 메인쿼리를 기준으로 여러 개의 서브 쿼리 사용 가능

## 서브쿼리의 종류
- 스칼라 서브쿼리(Scalar SubquerY)
- 인라인 뷰(Inline View)
- 중첩 서브쿼리(Nested Subquery)
- 메인쿼리와의 연관성 : 1. 연관성 있는 서브쿼리 = 메인쿼리와 조인
-                      2. 연관성 없는 서브쿼리 = 메인쿼리와 독립적
## 스칼라 서브쿼리(Scalar Subquery)
- 메인쿼리의 SELECT 절에 위치한 서브쿼리
- SELECT 절에서 마치 하나의 컬럼이나 표현식 처럼 사용
- 서브쿼리가 최종 반환하는 로우 수,컬럼,표현식은 1개
- 별칭(Alias)을 주는 것이 일반적 => 하나의 컬럼 역할을 하므로

## 인라인 뷰(Inline View)
- 메인쿼리의 FROM절에 위치
- 서브쿼리 자체가 마치 하나의 테이블 처럼 동작
- 서브쿼리가 최종 반환하는 로우와 컬럼, 표현식 수는 1개 이상 가능
- 서브쿼리에 대한 별칭(Alias)은 반드시 명시
- 메인쿼리와 조인조건은 메인쿼리의 WHERE절에서 처리가 일반적

- 인라인 뷰가 필요한 이유 : 기존 단일 테이블만 읽어서는 필요한 정보를 가져오기 어려울 때
- LATERAL 키워드 사용 시 서브쿼리 내에서 조인 가능 => 스칼라 서브쿼리 처럼 동작

## 중첩 서브쿼리(Nested Subquery)
- 메인쿼리의 WHERE 절에 위치
- 서브쿼리가 조건절의 일부로 사용됨
- 조건절의 조건절의 일부이므로 서브쿼리에 대한 별칭(Alias) 사용 불가
- 서브쿼리 내에서 메인쿼리와 조인 가능

## 세미 조인(Semi Join)
- 두 번째 테이블에 있는 로우와 조건이 맞는 첫 번째 테이블의 로우 반환
- 메인 쿼리와 중첩 서브쿼리를 사용할 때 사용하는 조인
- WHERE 절에서 EXISTS 연산자를 사용 => SELECT * FROM departments a WHERE EXISTS( SELECT 1 FROM employees b WHERE a.department_id = b.department_id);

## 안티 조인(Anti Join)
- 세미 조인에서 NOT 연산자 사용하는 조인
- 서브쿼리와의 조인조건에 부합하지 않는 건을 조회

## WITH절 or CTE(COMMON TABLE EXPRESSION)
- 서브쿼리의 일종
- WITH 절(clause)이라고도 하고 CTE라고도 함
- 하나의 서브쿼리를 또 다른 서브쿼리에서 참조하여 재 사용 가능한 구문
- WITH 별칭 AS 다음에 서브쿼리 형태
- WITH은 한번만 명시, 서브쿼리는 여러 개 사용 가능
- 최종 반환 결과는 마지막에 있는 메인 쿼리
- WITH절은 내부적으로 TEMP 테이블 스페이스를 사용함
- => TEMP 테이블스페이스에 각 서브쿼리 결과를 담아두고 있음
- TEMP 테이블스페이스는 정렬 용도로 사용

## 테이블에 있는 로우를 컬럼 형태로 변환
- 1. CASE WHEN THEN 문 사용
- 2. decode
- 3. WITH
- 4. PIVOT

## 테이블에 있는 컬럼을 로우 형태로 변환
- 1. UNION ALL
- 2. UNPIVOT
